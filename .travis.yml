sudo: false

language: python

python:
  - "2.7"

addons:
  apt:
    packages:
      - expect-dev  # provides unbuffer utility
      - python-lxml # because pip installation is slow
      - python-simplejson
      - python-serial
      - python-yaml
      - wkhtmltopdf # qweb reports, report_webkit

cache:
  directories:
    - parts
    - eggs

virtualenv:
  system_site_packages: true

before_install:
  - git config --global user.name "TravisCI"
  - git config --global user.email "travis@camptocamp.com"

env:
  matrix:
    - LINT_CHECK="1"
    - SCENARIO="1"
  global:
    - SCENARIO="0" TESTS="0" LINT_CHECK="0"
    - ADDONS_DIR=${TRAVIS_BUILD_DIR}/specific-parts/specific-addons

install:
  - if [ "$SCENARIO" == "1" ] ; then npm install -g less less-plugin-clean-css ; fi
  - if [ "$SCENARIO" == "1" ] ; then ${TRAVIS_BUILD_DIR}/bootstrap.sh profiles/travis.cfg ; fi
  - if [ "$SCENARIO" == "1" ] ; then ${TRAVIS_BUILD_DIR}/bin/buildout ; fi
  - if [ "$LINT_CHECK" == "1" ] ; then pip install -q flake8 ; fi

script:
  - if [ "$LINT_CHECK" == "1" ] ; then flake8 ${ADDONS_DIR} --exclude=__init__.py ; fi
  - if [ "$SCENARIO" == "1" ] ; then bin/oerpscenario -t swisslux -t setup -t ~slow ; fi
  - if [ "$SCENARIO" == "1" ] ; then bin/oerpscenario -t upgrade_from_9.0.3 -t ~slow ; fi
